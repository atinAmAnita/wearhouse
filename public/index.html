<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STOCKFORGE - Inventory Control</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>STOCKFORGE</h1>
            <p class="subtitle">Inventory Control System</p>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="add">Add Item</button>
            <button class="tab-btn" data-tab="lookup">Scan/Lookup</button>
            <button class="tab-btn" data-tab="inventory">Inventory</button>
            <button class="tab-btn" data-tab="advanced">Advanced</button>
            <!-- Hidden for development - eBay integration disabled -->
            <button class="tab-btn" data-tab="ebay" style="display:none">eBay Sync</button>
            <button class="tab-btn" data-tab="export">Export</button>
        </nav>

        <!-- Add Item Tab -->
        <section id="add" class="tab-content active">
            <h2>Add Item</h2>
            <form id="addItemForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="itemId">Item ID (4 digits)</label>
                        <div class="input-with-btn">
                            <input type="text" id="itemId" maxlength="4" pattern="[0-9]{4}" required placeholder="e.g., 1234">
                            <button type="button" class="btn btn-generate" onclick="generateNextItemId()">Auto</button>
                        </div>
                        <small class="field-hint">Unique product identifier</small>
                    </div>
                    <div class="form-group">
                        <label for="location">Location (5 digits: 3+2)</label>
                        <div class="input-with-btn">
                            <input type="text" id="location" maxlength="5" pattern="[0-9]{5}" required placeholder="e.g., 00101">
                            <button type="button" class="btn btn-generate" onclick="generateNextLocation()">Auto</button>
                        </div>
                        <small class="field-hint">Drawer (001-999) + Position (01-99)</small>
                    </div>
                </div>

                <!-- SKU Preview -->
                <div class="sku-preview">
                    <label>Generated SKU:</label>
                    <span id="skuPreview">----+-----</span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="price">Price</label>
                        <input type="number" id="price" min="0" step="0.01" placeholder="0.00" required>
                        <small class="field-hint">Selling price</small>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" id="quantity" min="1" value="1" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="description">Description (optional)</label>
                        <input type="text" id="description" placeholder="Item description">
                    </div>
                </div>

                <div id="itemStatus" class="location-status"></div>
                <button type="submit" id="submitBtn" class="btn btn-primary">New Item</button>
            </form>

            <div id="addResult" class="result-panel hidden">
                <h3>Item Added Successfully!</h3>
                <div class="item-details"></div>
                <div class="barcode-container">
                    <img id="barcodeImage" alt="Barcode">
                    <button class="btn btn-secondary" onclick="printBarcode()">Print Barcode</button>
                </div>
            </div>
        </section>

        <!-- Lookup Tab -->
        <section id="lookup" class="tab-content">
            <h2>Scan or Lookup Item</h2>
            <form id="lookupForm">
                <div class="form-group">
                    <label for="skuInput">Enter or Scan SKU</label>
                    <input type="text" id="skuInput" placeholder="Scan barcode or enter SKU" autofocus>
                </div>
                <button type="submit" class="btn btn-primary">Lookup</button>
            </form>

            <div id="lookupResult" class="result-panel hidden">
                <h3>Item Found</h3>
                <div class="item-details"></div>
                <div class="barcode-container">
                    <img id="lookupBarcodeImage" alt="Barcode">
                </div>
                <div class="action-buttons">
                    <div class="qty-adjust">
                        <button class="btn btn-secondary" onclick="adjustQuantity(-getAdjustQty())">Remove</button>
                        <input type="number" id="adjustQtyInput" value="1" min="1" class="qty-input">
                        <button class="btn btn-success" onclick="adjustQuantity(getAdjustQty())">Add</button>
                    </div>
                    <div class="price-adjust">
                        <label>Price: $</label>
                        <input type="number" id="adjustPriceInput" min="0" step="0.01" class="price-input" placeholder="0.00">
                        <button class="btn btn-primary" onclick="updatePrice()">Update Price</button>
                    </div>
                    <button class="btn btn-danger" onclick="deleteCurrentItem()">Delete</button>
                </div>
            </div>
        </section>

        <!-- Inventory Tab -->
        <section id="inventory" class="tab-content">
            <h2>Full Inventory</h2>
            <div class="inventory-controls">
                <input type="text" id="searchInventory" placeholder="Search inventory...">
                <button class="btn btn-secondary" onclick="loadInventory()">Refresh</button>
            </div>
            <div class="table-container">
                <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Location</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Description</th>
                            <th>Date Added</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="inventory-stats">
                <span id="totalItems">Total: 0 items</span>
                <span id="totalQuantity">Total quantity: 0</span>
            </div>
        </section>

        <!-- Advanced Tab - eBay Categories & Item Specifics -->
        <section id="advanced" class="tab-content">
            <h2>Advanced Item Settings</h2>
            <p class="subtitle">Configure eBay categories, condition, and item specifics</p>

            <!-- Item Selection -->
            <div class="form-group" style="max-width: 400px; margin-bottom: 20px;">
                <label for="advancedItemSelect">Select Item to Configure</label>
                <select id="advancedItemSelect" class="form-control">
                    <option value="">-- Select an item --</option>
                </select>
            </div>

            <!-- Selected Item Info -->
            <div id="advancedItemInfo" class="result-panel hidden" style="margin-bottom: 20px;">
                <div class="item-summary"></div>
            </div>

            <!-- Advanced Settings Form -->
            <div id="advancedSettings" class="hidden">
                <!-- Condition -->
                <div class="form-group">
                    <label for="itemCondition">Condition</label>
                    <select id="itemCondition" class="form-control">
                        <option value="">-- Select Condition --</option>
                        <option value="NEW">New</option>
                        <option value="NEW_OTHER">New (Other)</option>
                        <option value="NEW_WITH_DEFECTS">New with defects</option>
                        <option value="LIKE_NEW">Like New</option>
                        <option value="USED_EXCELLENT">Used - Excellent</option>
                        <option value="USED_VERY_GOOD">Used - Very Good</option>
                        <option value="USED_GOOD">Used - Good</option>
                        <option value="USED_ACCEPTABLE">Used - Acceptable</option>
                        <option value="FOR_PARTS_OR_NOT_WORKING">For parts or not working</option>
                    </select>
                </div>

                <!-- Category Search -->
                <div class="form-group">
                    <label for="categorySearch">eBay Category</label>
                    <div class="category-search-container">
                        <input type="text" id="categorySearch" placeholder="Search for a category (e.g., 'vintage watches', 'men's shirts')">
                        <button type="button" class="btn btn-secondary" onclick="Advanced.searchCategories()">Search</button>
                    </div>
                    <div id="categoryResults" class="category-results hidden"></div>
                    <div id="selectedCategory" class="selected-category hidden">
                        <span class="category-label">Selected:</span>
                        <span class="category-name"></span>
                        <button type="button" class="btn btn-sm btn-secondary" onclick="Advanced.clearCategory()">Change</button>
                    </div>
                </div>

                <!-- Item Specifics -->
                <div id="itemSpecificsSection" class="hidden">
                    <h3>Item Specifics</h3>
                    <p class="hint">Required fields are marked with *</p>
                    <div id="itemSpecificsContainer">
                        <!-- Dynamically filled with item specifics based on category -->
                    </div>
                </div>

                <!-- Save Button -->
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-primary" onclick="Advanced.saveSettings()">Save Advanced Settings</button>
                </div>
            </div>
        </section>

        <!-- eBay Sync Tab - Hidden for development -->
        <section id="ebay" class="tab-content" style="display:none">
            <h2>eBay Integration</h2>

            <!-- Status Message -->
            <div id="ebayStatus" class="ebay-status">
                <div class="status-card not-configured">
                    <div class="status-icon">?</div>
                    <div class="status-info">
                        <h3>Checking eBay status...</h3>
                        <p>Please wait</p>
                    </div>
                </div>
            </div>

            <!-- Not Configured Message -->
            <div id="ebayNotConfigured" class="ebay-setup hidden">
                <h3>eBay API Not Configured</h3>
                <p>Contact your administrator to configure the eBay API credentials.</p>
                <p>Admin panel: <a href="/admin">/admin</a></p>
            </div>

            <!-- No Accounts Message -->
            <div id="ebayNoAccounts" class="ebay-connect hidden">
                <p>No eBay accounts connected yet.</p>
                <p>Contact your administrator to connect eBay seller accounts.</p>
                <p>Admin panel: <a href="/admin">/admin</a></p>
            </div>

            <!-- Account Selection & Sync (shown when accounts exist) -->
            <div id="ebayControls" class="ebay-controls hidden">
                <!-- Account Selector -->
                <div class="form-group" style="max-width: 400px; margin: 0 auto 20px;">
                    <label for="accountSelect">Select eBay Account</label>
                    <select id="accountSelect" class="form-control" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        <option value="">-- Select Account --</option>
                    </select>
                </div>

                <div class="sync-actions">
                    <button class="btn btn-primary btn-large" onclick="syncAllToEbay()">Sync All Items to Selected Account</button>
                    <button class="btn btn-secondary" onclick="loadEbayInventory()">View eBay Inventory</button>
                </div>

                <!-- Connected Accounts List -->
                <div id="accountsList" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Connected eBay Accounts</h3>
                    <div id="accountsContainer"></div>
                </div>

                <div id="syncResults" class="sync-results hidden">
                    <h3>Sync Results</h3>
                    <div class="sync-summary"></div>
                </div>

                <div id="ebayInventory" class="ebay-inventory hidden">
                    <h3>eBay Inventory</h3>
                    <div class="table-container">
                        <table id="ebayInventoryTable">
                            <thead>
                                <tr>
                                    <th>SKU</th>
                                    <th>Title</th>
                                    <th>Quantity</th>
                                    <th>Condition</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Export Tab -->
        <section id="export" class="tab-content">
            <h2>Export Data</h2>
            <div class="export-options">
                <div class="export-card export-card-full">
                    <h3>Full Database Backup</h3>
                    <p>Export complete database with all history, categories, and item specifics. Use this for backup/restore or migrating between environments.</p>
                    <a href="/api/export/full" class="btn btn-success" download>Download Full Backup (JSON)</a>
                </div>
                <div class="export-card">
                    <h3>eBay File Exchange</h3>
                    <p>Export inventory in eBay's File Exchange CSV format for bulk updates.</p>
                    <a href="/api/export/ebay" class="btn btn-primary" download>Download eBay CSV</a>
                </div>
                <div class="export-card">
                    <h3>Excel Spreadsheet</h3>
                    <p>Export full inventory data as an Excel file.</p>
                    <a href="/api/export/excel" class="btn btn-primary" download>Download Excel</a>
                </div>
            </div>

            <h2 style="margin-top: 2rem;">Import Data</h2>
            <div class="export-options">
                <div class="export-card export-card-full">
                    <h3>Restore from Backup</h3>
                    <p>Import a full database backup (JSON). This will add new items and update existing ones.</p>
                    <input type="file" id="backupFileInput" accept=".json" style="display: none;" onchange="importFullBackup(this)">
                    <button class="btn btn-warning" onclick="document.getElementById('backupFileInput').click()">Upload Backup (JSON)</button>
                </div>
            </div>
        </section>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Item History</h2>
                <button class="modal-close" onclick="closeHistoryModal()">&times;</button>
            </div>
            <div id="historyContent" class="modal-body">
                <!-- History content loaded dynamically -->
            </div>
        </div>
    </div>

    <div id="notification" class="notification hidden"></div>

    <script src="app.js"></script>
</body>
</html>
